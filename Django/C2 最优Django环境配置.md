# 2 最优Django环境配置

本章描述了我们认为对于中等和高级Django使用者来说最优的本地环境配置

## 2.1 统一使用相同的数据库引擎

一个常见的开发者错误是在本地开发环境中使用SQLite3，而在生产环境中使用PostgreSQL(或MySQL)。本节的提示不仅仅适用于使用SQLite3和PostgreSQL这种种的情景，而是适用于任何你使用两种数据库却希望它们行为特性一致的情景。

下面是一些我们在开发和生产使用不同数据库时碰到的问题：

### 2.1.1 你不能在本地对线上数据的完整Copy做数据检查

当你的线上生产数据库和你的本地开发测试数据库不一样的时候，你就不能在本地数据库中对线上生产数据库的数据做完全复制，也就无法在本地做完整的数据检查。

当然你可以对线上数据库做一个SQL Dump，然后运行这些SQL把数据导入你的本地数据库，但是这不意味者你通过这样的导入导出得到的是线上数据的完整复制。

### 2.1.2 不同的数据库有不同的字段类型和数据约束

请牢记:不同的数据库可处理的数据字段的类型是不同的。Django的ORM努力去适配兼容这些不同的数据类型，但是其所能做的，也只有这么多。

比如：有些人在本地使用SQLite数据库，在线上生产环境用PostgreSQL数据库。他们认为Django ORM可以让他们不用考虑不同数据库的特性差异，最终他们都会陷入麻烦：因为SQLite是动态的弱类型，而不是PostgreSQL的强类型。

当然，Django ORM可以帮助你的代码以强类型的方式操作SQLite，但是表单和数据验证的错误在开发阶段不会被捕捉到，直到代码上线才会被发现。比如你在本地可以毫无障碍的存储长字符串，因为SQLite3不在乎这个，但是在生产环境里，你的PostgreSQL或MySQL会报出约束错误，这些错误你在本地测试环境中不会发现，你将很难重现这些问题，直到你建立一致的本地测试环境为止。

大多数问题都不会被发现，直到项目跑在一个强类型的数据库上(比如PostgreSQL或MySQL)，当这些类型的bug发生时，你应该结束自责，努力在本地开发环境中搭建正确的数据库。

-----------------------
**提示：Django+PostgreSQL组合**

据我们所知，大多数Django开发者在所有的环境优先使用PostgreSQL，这些环境包括开发环境、演示环境、QA环境、生产环境。

根据你的操作系统，可以使用以下操作

- Mac:下载一键Mac安装程序：http://postgresapp.com
- Windows:下载一键Windows安装程序：http://postgresql.org/download/windows/
- Linux:通过系统上的包管理器，或者使用以下指令：http://postgresql.org/download/linux/

你也许得花些功夫才能让PostgreSQL本地运行在某些操作系统上，但是你会发现花这些功夫是值得的。

-----------------------

### 2.1.3 固定数据(Fixtures)不是魔法解决方案

你也许想知道为什么不采用固定数据来使本地数据库和生产数据库的区别透明化。

对，固定数据在提供简单硬代码测试数据集方面是非常优秀的。有时你需要在开发中用假的测试数据填充你的数据库，特别是在早期项目的演示阶段

固定数据不是一个在数据库之间移植大量数据集的可信工具，它是一个具体数据库不明确的方式，它们根本就不应该那么用。不要错以为固定可以用来做在生产数据库和其他数据库之间移植数据的基础数据工具(dumpdata/loaddta)

## 2.2 使用Pip和Virtualenv

如果你目前还没用这它们，我们强烈建议你熟悉这两个工具。对于Django项目来说，它们是事实上的标准配置，大多数使用Django的公司都依赖于者两个工具

**Pip**是一个从Python包目录(Pypi)及其镜像获取Python包的工具.它用来管理和安装Python包，它和easy_install很像,不过有更多特性，关键的一个特性是支持Virtualenv。

**Virturlenv**是一个可以用来创建相互独立的Python环境的工具，这些独立的环境可以有不同的包依赖体系。当你同时开发多个项目且不同的项目依赖不同的包版本库时，你应该考虑使用Vitualenv。

举个例子：假设你开发两个项目，其中一个依赖Django1.7，一个依赖Django1.8.

- 如果没有使用Vituraenv(或者其他管理包依赖的替代工具),你将不得不在每次切换项目时重装Django。
- 如果你觉得这繁琐无用,请注意：大多数实际Django生成项目至少需要依赖12个以上的包。

Pip已经包含在Python3.4以及更新版本,深度阅读以及安装指令可以在以下页面找到:

- pip: http://pip-installer.org
- virtualenv: http://virtualenv.org

-----------------------
**提示：Django+PostgreSQL组合**
-----------------------



